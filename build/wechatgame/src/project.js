__require=function e(t,n,i){function r(o,c){if(!n[o]){if(!t[o]){var a=o.split("/");if(a=a[a.length-1],!t[a]){var h="function"==typeof __require&&__require;if(!c&&h)return h(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+o+"'")}}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){return r(t[o][1][e]||e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof __require&&__require,o=0;o<i.length;o++)r(i[o]);return r}({block:[function(e,t,n){"use strict";cc._RF.push(t,"e6a33g/I/NAjqvsWdrlMa6l","block"),cc.Class({extends:cc.Component,properties:{},onClick:function(e){},onLoad:function(){cc.systemEvent.on(cc.SystemEvent.EventType.BUTTON_LEFT,this.onClick,this)},start:function(){}}),cc._RF.pop()},{}],game:[function(e,t,n){"use strict";cc._RF.push(t,"89e4fuBbdZMTpEz55MiXhNF","game"),cc.Class({extends:cc.Component,properties:{starPrefab:{default:null,type:cc.Prefab},maxStarDuration:0,minStarDuration:0},start:function(){},onLoad:function(){cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().debugDrawFlags=cc.PhysicsManager.DrawBits.e_aabbBit},spawnNewStar:function(){var e=cc.instantiate(this.starPrefab);this.node.addChild(e),e.setPosition(this.getNewStarPosition()),e.getComponent("star").game=this},getNewStarPosition:function(){var e,t=this.groundY+Math.random()*this.player.getComponent("player").jumpHeight+50,n=this.node.width/2;return e=2*(Math.random()-.5)*n,cc.v2(e,t)}}),cc._RF.pop()},{}],map:[function(e,t,n){"use strict";cc._RF.push(t,"6d972COG4JLyqlzpLjHpWsI","map");var i=e("./base/perlinNoise"),r=e("./base/util");cc.Class({extends:cc.Component,properties:{blockPrefab:{default:null,type:cc.Prefab},chunkRange:[0,0]},getBlockInPool:function(){var e=null;return e=this.blockPool.size()>0?this.blockPool.get():cc.instantiate(this.blockPrefab),this.node.addChild(e),e},createNewChunk:function(e,t){var n={};n.centerPoint=t,n.id=e;for(var s=-r.BLOCK_PER_CHUNK_WIDTH/2;s<r.BLOCK_PER_CHUNK_WIDTH/2;s++){var o=this.perlin[""+(t[0]+s)];null!==o&&void 0!==o||(o=parseInt(i(.001*(t[0]+s),1.234)),this.perlin[""+(t[0]+s)]=o);for(var c=-r.BLOCK_PER_CHUNK_HEIGHT/2;c<r.BLOCK_PER_CHUNK_HEIGHT/2;c++){var a={};a.x=s,a.y=c,a.type=0,a.entity=0,t[1]+c<=o&&(a.type=1),t[1]+c!==o&&s!==-r.BLOCK_PER_CHUNK_WIDTH/2&&s!==r.BLOCK_PER_CHUNK_WIDTH/2-1&&c!==-r.BLOCK_PER_CHUNK_HEIGHT/2&&c!==r.BLOCK_PER_CHUNK_HEIGHT/2-1||1===a.type&&(a.entity=1),n[s+"|"+c]=a}}return this.worldMap[""+e]=n,n},initMap:function(){this.worldMap=this.worldMap?this.worldMap:{};for(var e=-16;e<16;e++)for(var t=-4;t<4;t++)this.createNewChunk(e+"|"+t,[e*r.BLOCK_PER_CHUNK_WIDTH,t*r.BLOCK_PER_CHUNK_HEIGHT])},getChunk:function(e){for(var t=[],n=e[0],i=e[1],s=-this.chunkRange[0]/2-1;s<=this.chunkRange[0]/2+1;s++)for(var o=-this.chunkRange[1]/2-1;o<=this.chunkRange[1]/2+1;o++){var c=parseInt(s),a=parseInt(o),h=this.worldMap[n+c+"|"+(i+a)];h||(h=this.createNewChunk(n+c+"|"+(i+a),[(n+c)*r.BLOCK_PER_CHUNK_WIDTH,(i+a)*r.BLOCK_PER_CHUNK_HEIGHT])),t.push(h)}return t},untargetAllRenderedChunks:function(){for(var e in this.renderedChunks)this.renderedChunks[e].rendered=!1},clearUnrenderedChunks:function(){for(var e in this.renderedChunks){var t=this.renderedChunks[e];if(!1===t.rendered){var n=!0,i=!1,r=void 0;try{for(var s,o=t.renderBlocks[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var c=s.value;1===c.type&&this.blockPool.put(c.block)}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}delete this.renderedChunks[e]}}},disChunk:function(e){this.untargetAllRenderedChunks();var t=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var c=s.value;if(this.renderedChunks[c.centerPoint[0]+"|"+c.centerPoint[1]])this.renderedChunks[c.centerPoint[0]+"|"+c.centerPoint[1]].rendered=!0;else{this.renderedChunks[c.centerPoint[0]+"|"+c.centerPoint[1]]={};var a=this.renderedChunks[c.centerPoint[0]+"|"+c.centerPoint[1]];a.rendered=!0,a.renderBlocks=[],a.centerPoint=c.centerPoint;for(var h=-r.BLOCK_PER_CHUNK_WIDTH/2;h<r.BLOCK_PER_CHUNK_WIDTH/2;h++)for(var u=-r.BLOCK_PER_CHUNK_HEIGHT/2;u<r.BLOCK_PER_CHUNK_HEIGHT/2;u++){var l=c[h+"|"+u],d={};if(d.type=l.type,d.position=[h,u],d.chunkPosition=c.centerPoint,1===d.type){var p=this.getBlockInPool();p.x=(l.x+c.centerPoint[0])*r.BLOCK_WIDTH,p.y=(l.y+c.centerPoint[1])*r.BLOCK_HEIGHT,p.getComponent("block").map=this,l.entity?p.getComponent(cc.PhysicsCollider).enabled=!0:p.getComponent(cc.PhysicsCollider).enabled=!1,d.block=p}a.renderBlocks.push(d)}}}}catch(e){n=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}this.clearUnrenderedChunks()},reflushMap:function(){var e=this.getChunk(this.player.currChunk);0<e.length&&(console.log("map will reflush."),this.disChunk(e))},onLoad:function(){console.log(cc),this.node.setContentSize(this.node.parent.getContentSize()),this.node.setPosition(-this.node.x/2,-this.node.y/2),this.node.setAnchorPoint(0,0),this.player=this.node.getChildByName("player"),cc.log(this.node.children),this.player.map=this,this.player.reflushMap=this.reflushMap.bind(this),this.player.gamePosition=[0,120],this.player.currChunk=[this.player.gamePosition[0]/r.BLOCK_PER_CHUNK_WIDTH,this.player.gamePosition[1]/r.BLOCK_PER_CHUNK_HEIGHT],this.perlin={},this.player.setPosition(this.player.gamePosition[0]*r.BLOCK_WIDTH,this.player.gamePosition[1]*r.BLOCK_HEIGHT),this.blockPool=new cc.NodePool,this.renderedChunks={},this.chunkRange=[parseInt(this.node.width/r.BLOCK_WIDTH/r.BLOCK_PER_CHUNK_WIDTH)+2,parseInt(this.node.height/r.BLOCK_HEIGHT/r.BLOCK_PER_CHUNK_HEIGHT)+2],this.initMap(),this.reflushMap()},start:function(){}}),cc._RF.pop()},{"./base/perlinNoise":"perlinNoise","./base/util":"util"}],perlinNoise:[function(e,t,n){"use strict";cc._RF.push(t,"a2c7a8h74RGHrGgn5ztTjMi","perlinNoise"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){for(var n=0,s=i,o=0;o<r;o++){var c=Math.pow(2,o),h=Math.pow(s,o);n+=a(e*c,t*c)*h}return 1e3*n};var i=.5,r=4;function s(e,t){var n=e+57*t;return 1-((n^=n<<13)*(n*n*15731+789221)+1376312589&2147483647)/1073741824}function o(e,t){return(s(e-1,t-1)+s(e+1,t-1)+s(e-1,t+1)+s(e+1,t+1))/16+(s(e-1,t)+s(e+1,t)+s(e,t-1)+s(e,t+1))/8+s(e,t)/4}function c(e,t,n){var i=n*Math.PI,r=.5*(1-Math.cos(i));return e*(1-r)+t*r}function a(e,t){var n=parseInt(e),i=e-n,r=parseInt(t),s=t-r,a=o(n,r),h=o(n+1,r),u=o(n,r+1),l=o(n+1,r+1);return c(c(a,h,i),c(u,l,i),s)}t.exports=n.default,cc._RF.pop()},{}],player:[function(e,t,n){"use strict";cc._RF.push(t,"bf189epNOhC4IiBoRik8VD6","player");var i=e("./base/util");cc.Class({extends:cc.Component,properties:{jumpHeight:0,jumpDuration:0,maxMoveSpeed:0,accel:0},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY.a:this.accLeft=!0;break;case cc.macro.KEY.d:this.accRight=!0;break;case cc.macro.KEY.w:case cc.macro.KEY.up:this.accUp=!0;break;case cc.macro.KEY.s:this.accDown=!0}},onKeyUp:function(e){switch(e.keyCode){case cc.macro.KEY.a:this.accLeft=!1;break;case cc.macro.KEY.d:this.accRight=!1;break;case cc.macro.KEY.w:this.accUp=!1;break;case cc.macro.KEY.s:this.accDown=!1}},onLoad:function(){this.accLeft=!1,this.accRight=!1,this.accUp=!1,this.accDown=!1,this.jumping=!1,this.collisionX=0,this.collisionY=0,this.touchingNumber=0,this.xSpeed=0,this.ySpeed=0,console.log(this),this.rigidbody=this.node.getComponent(cc.RigidBody),this.rigidbody.linearDamping=.1,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.label=this.node.getChildByName("dis")},start:function(){},update:function(e){this.xSpeed/Math.abs(this.xSpeed)&&(this.xSpeed,Math.abs(this.xSpeed)),this.ySpeed/Math.abs(this.ySpeed)&&(this.ySpeed,Math.abs(this.ySpeed));var t=this.rigidbody.linearVelocity;this.accLeft?t.x-=this.accel*e:this.accRight&&(t.x+=this.accel*e),this.accUp&&!this.jumping&&(t.y-=cc.director.getPhysicsManager().gravity.y,this.jumping=!0),this.rigidbody.linearVelocity=t,this.label&&(this.label.string=this.node.x+" \n"+this.node.y+" \n  "+this.rigidbody.linearVelocity.x+"\n "+this.rigidbody.linearVelocity.y),this.node.lastGamePosition=this.node.gamePosition?this.node.gamePosition:[0,5],this.node.gamePosition=[i.pixel2AbsoluteBlockId_W(this.node.x/16),i.pixel2AbsoluteBlockId_H(this.node.y/16)],this.node.lastChunk=this.node.currChunk?this.node.currChunk:[0,0],this.node.currChunk=[i.pixel2ChunkId_W(this.node.x),i.pixel2ChunkId_W(this.node.y)],(Math.abs(this.node.currChunk[0]-this.node.lastChunk[0])>0||Math.abs(this.node.currChunk[1]-this.node.lastChunk[1])>0)&&this.node.reflushMap()},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},onBeginContact:function(e,t,n){this.jumping=!1},onEndContact:function(e,t,n){},onPreSolve:function(e,t,n){},onPostSolve:function(e,t,n){}}),cc._RF.pop()},{"./base/util":"util"}],star:[function(e,t,n){"use strict";cc._RF.push(t,"4377eQgN6dAC4dI8JfXHhl5","star"),cc.Class({extends:cc.Component,properties:{pickRadius:0},start:function(){},getPlayerDistance:function(){var e=this.game.player.getPosition();return this.node.position.sub(e).mag()},onPicked:function(){this.game.spawnNewStar(),this.node.destroy()}}),cc._RF.pop()},{}],util:[function(e,t,n){"use strict";cc._RF.push(t,"26028GivI9DGbVGfupJDJve","util"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.BLOCK_WIDTH=16,this.BLOCK_HEIGHT=16,this.BLOCK_PER_CHUNK_WIDTH=16,this.BLOCK_PER_CHUNK_HEIGHT=16,this.CHUNK_WIDTH=this.BLOCK_WIDTH*this.BLOCK_PER_CHUNK_WIDTH,this.CHUNK_HEIGHT=this.BLOCK_HEIGHT*this.BLOCK_PER_CHUNK_HEIGHT}return i(e,[{key:"pixel2ChunkId_W",value:function(e){return parseInt(e/this.CHUNK_WIDTH)}},{key:"pixel2ChunkId_H",value:function(e){return parseInt(e/this.CHUNK_HEIGHT)}},{key:"chunkId2Pixel_W",value:function(e){return parseInt(e*this.CHUNK_WIDTH)}},{key:"chunkId2Pixel_H",value:function(e){return parseInt(e*this.CHUNK_HEIGHT)}},{key:"pixel2AbsoluteBlockId_W",value:function(e){return parseInt(e/this.BLOCK_WIDTH)}},{key:"pixel2AbsoluteBlockId_H",value:function(e){return parseInt(e/this.BLOCK_HEIGHT)}},{key:"absoluteBlockId2Pixel_W",value:function(e){return parseInt(e*this.BLOCK_WIDTH)}},{key:"absoluteBlockId2Pixel_H",value:function(e){return parseInt(e*this.BLOCK_HEIGHT)}}]),e}();n.default=new r,t.exports=n.default,cc._RF.pop()},{}]},{},["perlinNoise","util","block","game","map","player","star"]);